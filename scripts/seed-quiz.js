/**
 * 乙4（乙種第4類危険物取扱者）クイズデータをSupabaseのquizテーブルに保存するスクリプト
 *
 * 準備:
 *   1. npm install @supabase/supabase-js
 *   2. Supabaseの quiz テーブルを作成（scripts/quiz-schema.sql を参照）
 *
 * 環境変数:
 *   SUPABASE_URL - Supabase プロジェクトのURL
 *   SUPABASE_SERVICE_ROLE_KEY - サービスロールキー（推奨）または SUPABASE_ANON_KEY
 *
 * 実行: node scripts/seed-quiz.js
 */

const { createClient } = require('@supabase/supabase-js');

const QUIZ_DATA = [
  {
    question: '第4類危険物に共通する性質として、誤っているものはどれか。',
    choices: [
      '蒸気は空気より重い',
      '水に溶けないものが多い',
      '静電気が発生しやすい',
      'すべて腐食性が強い'
    ],
    correct_index: 3,
    explanations: [
      '正しい。第4類危険物の蒸気は、空気より重く低所に滞留する性質がある。',
      '正しい。ガソリン、灯油、軽油など多くの第4類危険物は水に溶けない。',
      '正しい。流動により静電気が発生しやすく、火花による引火の危険がある。',
      '誤り。第4類危険物は腐食性が強いとは限らない。腐食性は酸・アルカリなどに多い性質である。'
    ]
  },
  {
    question: 'ガソリンの発火点として、適切なものはどれか。',
    choices: [
      '約-40℃',
      '約40℃',
      '約300℃',
      '約600℃'
    ],
    correct_index: 2,
    explanations: [
      'ガソリンの引火点（-40℃程度）と混同しやすい。引火点は火炎を近づけたとき引火する最低温度。',
      '40℃は常温付近で、ガソリンがこの温度で発火するわけではない。',
      '正解。ガソリンの発火点は約300℃。発火点は火炎なしで自然発火する温度。',
      '600℃は高すぎる。ガソリンの発火点は300℃程度である。'
    ]
  },
  {
    question: '第4類危険物の消火に適した消火剤でないものはどれか。',
    choices: [
      '泡消火剤',
      'ハロゲン化物消火剤',
      '強化液消火剤',
      '二酸化炭素消火剤'
    ],
    correct_index: 2,
    explanations: [
      '適している。泡は燃焼面を覆い、酸素供給を断つ窒息効果がある。',
      '適している。ハロゲン化物は燃焼の連鎖反応を抑制する抑制作用がある。',
      '適していない。強化液は主に普通火災（A火災）用。水溶性の第4類危険物には不適。',
      '適している。二酸化炭素は窒息消火の効果がある。'
    ]
  },
  {
    question: '灯油の危険性の等級（指定数量の倍数）として正しいものはどれか。',
    choices: [
      '第1石油類（非水溶性）・等級2',
      '第2石油類（非水溶性）・等級2',
      '第2石油類（非水溶性）・等級3',
      '第3石油類・等級3'
    ],
    correct_index: 2,
    explanations: [
      '第1石油類はガソリンなど引火点が21℃未満のもの。灯油は第2石油類。',
      '灯油は第2石油類だが、等級は3である。等級2はアセトンなど。',
      '正解。灯油は第2石油類（非水溶性）で、危険性の等級は3である。',
      '第3石油類は重油など。灯油は第2石油類に分類される。'
    ]
  },
  {
    question: '静電気による火災を防止するために、重要な対策として正しいものはどれか。',
    choices: [
      '流速を速くして作業時間を短縮する',
      '金属製容器に貯蔵し、アースを取る',
      '湿度を低く保つ',
      '合成繊維の作業服を着用する'
    ],
    correct_index: 1,
    explanations: [
      '流速を速くすると静電気の発生量が増加する。流速は遅くすることが望ましい。',
      '正解。金属製容器は導体でアースを取ることで静電気を大地に逃がせる。',
      '湿度が低いと静電気が発生しやすい。湿度を高く保つことが対策になる。',
      '合成繊維は静電気を帯びやすい。綿など天然繊維の作業服が望ましい。'
    ]
  },
  {
    question: '指定数量を超える危険物を貯蔵する場合、必ず届出が必要なものはどれか。',
    choices: [
      '市町村長',
      '都道府県知事',
      '消防署長',
      '労働基準監督署長'
    ],
    correct_index: 0,
    explanations: [
      '正解。消防法では、指定数量を超える危険物の貯蔵には市町村長への届出が必要。',
      '都道府県知事への届出は、製造所等の設置許可の場合など。貯蔵の届出は市町村長。',
      '消防署は届出の窓口となることが多いが、法的な届出先は市町村長。',
      '労働基準監督署は労働安全衛生法の管轄。危険物の貯蔵届出とは無関係。'
    ]
  },
  {
    question: '危険物の貯蔵タンクに施す防油堤の高さについて、正しいものはどれか。',
    choices: [
      'タンク内の危険物が漏れた場合に、その量を貯留できる容量を有すること',
      '高さは0.5m以上とすること',
      'タンクの最大容量の110％以上を貯留できる容量とすること',
      '防油堤の面積は、タンクの水平断面積の50％以上とすること'
    ],
    correct_index: 0,
    explanations: [
      '正解。防油堤は、漏洩した危険物を貯留できる容量を有することが要件。',
      '高さの規定は0.5m以上という単純な数値ではない。容量が重要。',
      '110％という規定は防油堤にはない。',
      '面積の50％という規定は防油堤の要件として誤り。容量で規定される。'
    ]
  },
  {
    question: 'アセトンの性状について、正しいものはどれか。',
    choices: [
      '水に溶けない',
      '第3石油類に分類される',
      '蒸気は空気より軽い',
      '水とよく混ざり合う'
    ],
    correct_index: 3,
    explanations: [
      'アセトンは水に溶ける（水溶性）。第4類の中でも水溶性危険物に分類される。',
      'アセトンは第1石油類（水溶性）に分類される。',
      'アセトンの蒸気も空気より重い。第4類危険物の蒸気は一般に空気より重い。',
      '正解。アセトンは水と任意の割合で混ざり合う水溶性の危険物である。'
    ]
  },
  {
    question: '引火点の説明として、正しいものはどれか。',
    choices: [
      '火炎を近づけたとき、3秒間以上継続して燃焼する最低の液温',
      '火炎を近づけたとき、5秒間以上継続して燃焼する最低の液温',
      '火炎を近づけなくても、自然に発火する最低の液温',
      '密閉容器内で点火源によって爆発する濃度範囲'
    ],
    correct_index: 1,
    explanations: [
      '3秒間ではなく5秒間である。',
      '正解。引火点は、火炎を近づけたときに5秒間以上燃焼する最低の液温。',
      'これは発火点の説明。発火点は火炎なしで自然発火する温度。',
      'これは爆発範囲（燃焼範囲）の説明。引火点とは異なる。'
    ]
  },
  {
    question: '重油の火災に対して、水系の消火剤を使用する場合の注意として正しいものはどれか。',
    choices: [
      '重油は水に溶けるので、大量の注水が有効である',
      '注水により油が浮上・拡散し、延焼の危険がある',
      '重油の温度が高いため、水は直ちに蒸発して効果がない',
      '重油と水は反応して有毒ガスを発生する'
    ],
    correct_index: 1,
    explanations: [
      '重油は水に溶けない（非水溶性）。第3石油類に分類される。',
      '正解。水は油より重く油の下に沈む。油が浮き上がり表面積が増え、延焼・拡大の危険がある。',
      '注水の際の問題は温度よりも、油の浮上・拡散が主な懸念である。',
      '重油と水が化学反応して有毒ガスを発生するわけではない。'
    ]
  }
];

async function seedQuiz() {
  const supabaseUrl = process.env.SUPABASE_URL;
  const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_ANON_KEY;

  if (!supabaseUrl || !supabaseKey) {
    console.error('エラー: 環境変数 SUPABASE_URL と SUPABASE_SERVICE_ROLE_KEY（または SUPABASE_ANON_KEY）を設定してください。');
    process.exit(1);
  }

  const supabase = createClient(supabaseUrl, supabaseKey);

  console.log('quizテーブルにデータを投入しています...');

  const records = QUIZ_DATA.map((q) => ({
    question: q.question,
    choices: q.choices,
    correct_index: q.correct_index,
    explanations: q.explanations,
  }));

  const { error } = await supabase
    .from('quiz')
    .insert(records);

  if (error) {
    console.error('エラー:', error.message);
    process.exit(1);
  }

  console.log(`${QUIZ_DATA.length}件のクイズデータを保存しました。`);
}

seedQuiz();
